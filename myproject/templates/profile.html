{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="navbar">
    <h2>My Profile</h2>
    <div class="nav-links">
        <button id="backBtn">Back</button>
        <button id="logoutBtn">Logout</button>
    </div>
</div>

<div class="container">
    <label>Full Name:</label>
    <input id="full_name" placeholder="Full Name">

    <label>Date of Birth:</label>
    <input id="date_of_birth" type="date">

    <label>Email:</label>
    <input id="email" placeholder="Email">

    <label>Address:</label>
    <input id="address" placeholder="Address">

    <label>Gender:</label>
    <select id="gender">
        <option value="">Select Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
    </select>

    <label>Mobile Number:</label>
    <input id="mobile_number" placeholder="Mobile Number">

    <div class="btns" style="width: 100%; display: flex; gap: 10px;">
        <button id="updateBtn">Update Profile</button>
        <button id="resetPasswordBtn">Reset Password</button>
    </div>
</div>

<script>
const baseUrl = "http://127.0.0.1:8000/api";
const token = localStorage.getItem('access');

function loadProfile(){
    $.ajax({
        url: `${baseUrl}/profile/`,
        method: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(res){
            $('#full_name').val(res.full_name);
            $('#date_of_birth').val(res.date_of_birth);
            $('#email').val(res.email);
            $('#address').val(res.address);
            $('#gender').val(res.gender);
            $('#mobile_number').val(res.mobile_number);
        },
        error: function(err){
            console.log(err);
            alert("Failed to load profile.");
        }
    });
}


$('#updateBtn').click(function(){
    const data = {
        full_name: $('#full_name').val(),
        date_of_birth: $('#date_of_birth').val(),
        email: $('#email').val(),
        address: $('#address').val(),
        gender: $('#gender').val(),
        mobile_number: $('#mobile_number').val()
    };
    $.ajax({
        url: `${baseUrl}/profile/`,
        method: 'PUT',
        headers: { 'Authorization': 'Bearer ' + token },
        contentType: 'application/json',
        data: JSON.stringify(data),
        success: function(res){
            alert("Profile updated successfully!");
            window.location.href = `${baseUrl}/user-notes/`;
        },
        error: function(err){
            console.log(err);
            alert("Failed to update profile.");
        }
    });
});

$('#backBtn').click(function() {
    window.location.href = `${baseUrl}/user-notes/`;
});

$('#resetPasswordBtn').click(function() {
    window.location.href = `${baseUrl}/reset-password/`; 
});

loadProfile();
</script>

</body>
</html>
